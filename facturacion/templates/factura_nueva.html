{% extends "base.html" %}
{% block content %}
<h2 class="mb-3">Nueva factura</h2>
<form method="post" action="{{ url_for('facturas_crear') }}">
  <div class="row g-3">
    <div class="col-md-3">
      <label class="form-label">NFAC</label>
      <input name="NFAC" required class="form-control" placeholder="F000000001">
    </div>
    <div class="col-md-3">
      <label class="form-label">Fecha emisi√≥n</label>
      <input type="date" name="FECEM" value="{{ hoy }}" class="form-control">
    </div>
    <div class="col-md-3">
      <label class="form-label">Fecha venc.</label>
      <input type="date" name="FECVEN" class="form-control">
    </div>
    <div class="col-md-3">
      <label class="form-label">Descuento (S/)</label>
      <input type="number" step="0.01" name="DESC" value="0" class="form-control">
    </div>

    <div class="col-md-4">
      <label class="form-label">Cliente</label>
      <select name="CODI" class="form-select">
        {% for c in clientes %}<option value="{{ c.CODI }}">{{ c.nom }} ({{ c.CODI }})</option>{% endfor %}
      </select>
    </div>
    <input type="hidden" name="EMPR" value="E0001">
    <div class="col-md-4">
      <label class="form-label">Empresa</label>
      <input class="form-control" value="Empresa ABC SAC (E0001)" disabled>
    </div>
    <div class="col-md-4">
      <label class="form-label">Vendedor</label>
      <select name="CODV" class="form-select">
        {% for v in vendedores %}<option value="{{ v.CODV }}">{{ v.nom }} ({{ v.CODV }})</option>{% endfor %}
      </select>
    </div>
  </div>

  <hr class="my-4">
  <h5>Detalle</h5>
  <div id="items"></div>
  <button type="button" class="btn btn-outline-primary my-2" onclick="addItem()">+ Agregar producto</button>

  <div class="mt-3">
    <button class="btn btn-success">Guardar factura</button>
    <a class="btn btn-secondary" href="{{ url_for('facturas') }}">Cancelar</a>
  </div>
</form>

<script>
function addItem(){
  const div = document.createElement('div');
  div.className = "row g-2 align-items-end mb-2";
  div.innerHTML = `
    <div class="col-md-6">
      <label class="form-label">Producto</label>
      <select name="CODT[]" class="form-select">
        {% for p in productos %}
          <option value="{{ p.CODT }}">{{ p.NOMB }} ({{ p.UNID }}) - S/ {{ p.PREC }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-3">
      <label class="form-label">Cantidad</label>
      <input type="number" min="1" value="1" name="CANT[]" class="form-control">
    </div>
    <div class="col-md-3">
      <button type="button" class="btn btn-outline-danger" onclick="this.closest('.row').remove()">Quitar</button>
    </div>
  `;
  document.getElementById('items').appendChild(div);
}
addItem();
</script>
{% endblock %}
